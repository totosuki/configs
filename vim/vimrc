" åŸºæœ¬è¨­å®š
set fenc=utf-8
set nobackup
set noswapfile
set autoread
set hidden
set showcmd
set scrolloff=999
set backspace=indent,eol,start

" è¦‹ãŸç›®ç³»
set number
set cursorline
set virtualedit=onemore
set smartindent
set wildmode=list:longest
syntax enable
set ruler
set statusline=\ %F%m%=%l/%L\ %P\ 

" Tabç³»
set expandtab
set tabstop=4
set shiftwidth=4

" æ¤œç´¢ç³»
set ignorecase
set smartcase
set incsearch
set wrapscan
set hlsearch

" Plugin
call plug#begin('~/.config/vim/plugged')
Plug 'scrooloose/nerdtree'
Plug 'ayu-theme/ayu-vim' 
Plug 'prabirshrestha/vim-lsp'
Plug 'mattn/vim-lsp-settings'
call plug#end()

" NERDTreeè¨­å®š
let NERDTreeShowHidden=1
let NERDTreeQuitOnOpen=1
let NERDTreeAutoDeleteBuffer=1
let NERDTreeMinimalUI=0
let NERDTreeDirArrows=1
let NERDTreeAutoCenter=1
let NERDTreeWinSize=25

" NERDTreeã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°
nnoremap <silent> <C-n> :NERDTreeToggle<CR>
nnoremap <silent> <C-f> :NERDTreeFind<CR>

" vimèµ·å‹•æ™‚ã«NERDTreeã‚’è‡ªå‹•ã§é–‹ãï¼ˆãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®šãªã—ã®å ´åˆï¼‰
autocmd vimenter * if !argc() | NERDTree | endif

" æœ€å¾Œã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒNERDTreeã®å ´åˆã¯è‡ªå‹•ã§é–‰ã˜ã‚‹
autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTree") && b:NERDTree.isTabTree()) | q | endif

" ãƒ†ãƒ¼ãƒè¨­å®š
set termguicolors     
let ayucolor="mirage" " for mirage version of theme
colorscheme ayu

" èƒŒæ™¯è‰²ã‚’é€æ˜ã«è¨­å®š
highlight Normal ctermbg=NONE guibg=NONE
highlight NonText ctermbg=NONE guibg=NONE
highlight LineNr ctermbg=NONE guibg=NONE
highlight SignColumn ctermbg=NONE guibg=NONE
highlight StatusLine ctermbg=NONE guibg=NONE
highlight StatusLineNC ctermbg=NONE guibg=NONE

" ã‚«ãƒ¼ã‚½ãƒ«è¡Œã®èƒŒæ™¯è‰²ã‚’è–„ãè¨­å®š
highlight CursorLine ctermbg=237 guibg=#3e4b59 cterm=NONE gui=NONE 

" LSPè¨­å®š
function! s:on_lsp_buffer_enabled() abort
    setlocal omnifunc=lsp#complete
    setlocal signcolumn=yes
    if exists('+tagfunc') | setlocal tagfunc=lsp#tagfunc | endif
    nmap <buffer> gd <plug>(lsp-definition)
    nmap <buffer> gs <plug>(lsp-document-symbol-search)
    nmap <buffer> gS <plug>(lsp-workspace-symbol-search)
    nmap <buffer> gr <plug>(lsp-references)
    nmap <buffer> gi <plug>(lsp-implementation)
    nmap <buffer> gt <plug>(lsp-type-definition)
    nmap <buffer> <leader>rn <plug>(lsp-rename)
    nmap <buffer> [g <plug>(lsp-previous-diagnostic)
    nmap <buffer> ]g <plug>(lsp-next-diagnostic)
    nmap <buffer> K <plug>(lsp-hover)
    nnoremap <buffer> <expr><c-f> lsp#scroll(+4)
    nnoremap <buffer> <expr><c-d> lsp#scroll(-4)

    let g:lsp_format_sync_timeout = 1000
    autocmd! BufWritePre *.rs,*.go call execute('LspDocumentFormatSync')
    
    " inoremap <buffer> <expr><c-f> lsp#scroll(+4)
    " inoremap <buffer> <expr><c-d> lsp#scroll(-4)
endfunction

augroup lsp_install
    au!
    autocmd User lsp_buffer_enabled call s:on_lsp_buffer_enabled()
augroup END

" rust-analyzerè¨­å®š
if executable('rust-analyzer')
    au User lsp_setup call lsp#register_server({
        \ 'name': 'rust-analyzer',
        \ 'cmd': {server_info->['rust-analyzer']},
        \ 'whitelist': ['rust'],
        \ })
endif

" LSPã®è¦‹ãŸç›®è¨­å®š
let g:lsp_signs_enabled = 1
let g:lsp_diagnostics_echo_cursor = 1
let g:lsp_signs_error = {'text': 'âœ—'}
let g:lsp_signs_warning = {'text': 'âš '}
let g:lsp_signs_information = {'text': 'â„¹'}
let g:lsp_signs_hint = {'text': 'ğŸ’¡'}
let g:lsp_highlight_references_enabled = 1

" è£œå®Œè¨­å®š
let g:lsp_completion_resolve_timeout = 60
